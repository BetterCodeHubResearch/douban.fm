{"version":3,"sources":["../libs/sdk.js"],"names":[],"mappings":"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","file":"libs/sdk.js","sourcesContent":["import path from 'path'\nimport fs from 'fsplus'\nimport douban from 'douban-sdk'\nimport utils from './utils'\nimport errors from './errors'\n\nexport const mhz = {\n  'localMhz': {\n    'seq_id': -99,\n    'abbr_en': 'localMhz',\n    'name': '本地电台',\n    'channel_id': -99,\n    'name_en': 'localMhz'\n  },\n  'privateMhz': {\n    'seq_id': -3,\n    'abbr_en': '',\n    'name': '红心兆赫',\n    'channel_id': -3,\n    'name_en': '',\n  },\n}\n\nexport function fm() {\n  return (new douban).fm\n}\n\nexport function fetchSongs(params, callback) {\n  var local = params && params.local && params.history\n\n  if (local) \n    return listLocalSongs(params.local, params.history, callback)\n\n  if (params.history) \n    delete params.history\n\n  var query = {\n    'qs': params\n  }\n\n  return douban.fm.songs(query, callback)\n}\n\nexport function addToLove(params, callback) {\n  params.type = 'r'\n  return fetchSongs(params, callback)\n}\n\nexport function listLocalSongs(dir, history, callback) {\n  fs.readdir(dir, readLocalDir);\n\n  function readLocalDir(err, songs) {\n    if (err) \n      return callback(err)\n    if (!songs) \n      return callback(new Error(errors.localsongs_notfound))\n\n    var list = []\n\n    fs.readJSON(history, (err, history) => {\n      if (err) \n        return callback(new Error(errors.localsongs_notfound))\n\n      songs.forEach((song) => {\n        if (song.lastIndexOf('.mp3') !== (song.length - 4)) \n          return\n\n        var s = history[utils.sid(song)] || {}\n        s.url = path.resolve(dir, song)\n\n        list.push(s)\n      })\n\n      if (list.length === 0) \n        return callback(new Error(errors.localsongs_notfound))\n\n      list.sort((a, b) => {\n        return Math.random() - 0.5\n      })\n\n      return callback(null, list)\n    })\n  }\n}\n"]}