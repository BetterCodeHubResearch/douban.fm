{"version":3,"sources":["../libs/commands.js"],"names":[],"mappings":"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","file":"libs/commands.js","sourcesContent":["import fs from 'fsplus'\nimport path from 'path'\nimport async from 'async'\nimport inquirer from \"inquirer\"\nimport consoler from 'consoler'\nimport Fm from './fm'\nimport sdk from './sdk'\nimport utils from './utils'\nimport menu from './menu'\n\n/**\n * [Show configs UI]\n * @param  {Object} fm   [a douban.fm instance]\n * @param  {Array}  argv [command line arguments]\n */\nexport function config(fm, argv) {\n  inquirer.prompt(menu.main, (result) => {\n    var exports = module.exports\n\n    if (!exports[result.type]) \n      return exports.help()\n\n    exports[result.type](fm, argv)\n  })\n}\n\n/**\n * [Auth and save user's account infomation and token]\n * @param  {Object} fm [a douban.fm instance]\n */\nexport function account(fm) {\n  inquirer.prompt(menu.account, (result) => {\n    var form = {\n      form: result\n    }\n\n    sdk.fm.auth(form, (err, account) => {\n      if (err) \n        return consoler.error(err);\n\n      var configs = {\n        account\n      }\n\n      try {\n        fs.updateJSON(fm.path.profile, configs)\n      } catch (err) {\n        if (!utils.noSuchFile(err.message)) \n          return consoler.error(err)\n\n        fs.writeJSON(fm.path.profile, configs)\n      }\n\n      return getReady(account)\n    })\n  })\n\n  function getReady(account) {\n    consoler.success(\n      `欢迎，${ account.user_name }。您的豆瓣账户已经成功修改为：${ account.email }`\n    )\n\n    fm.init(ready)\n  }\n}\n\n/**\n * [Update download directory path]\n * @param  {Object} fm   [a douban.fm instance]\n * @param  {Array}  argv [command line arguments]\n */\nexport function download(fm, argv) {\n  var workingPath = process.cwd()\n  var profile = {}\n\n  inquirer.prompt(menu.download.main(workingPath), (result) => {\n    if (!result.useWorkingPath) \n      return inputNewPath()\n\n    profile.home = workingPath\n\n    return updatePath(profile)\n  });\n\n  function inputNewPath() {\n    inquirer.prompt(menu.download.setting, (dir) => {\n      if (!fs.existsSync(dir.download)) {\n        console.log(dir.download + ' 这个目录好像并不存在，请输入一个有效的路径')\n        return inputNewPath()\n      }\n\n      profile.home = dir.download\n\n      return updatePath(profile)\n    });\n  }\n\n  function updatePath(profile) {\n    try {\n      fs.updateJSON(fm.path.profile, profile)\n    } catch (err) {\n      if (!utils.noSuchFile(err.message)) \n        return consoler.error(err)\n\n      fs.writeJSON(fm.path.profile, profile)\n    }\n\n    consoler.success('下载目录已成功修改为 ' + profile.home)\n\n    return (new Fm).init(exports.ready)\n  }\n}\n\n/**\n * [Update ID3 tags for local songs]\n * @param  {Object} fm   [a douban.fm instance]\n * @param  {Array}  argv [command line arguments]\n */\nexport function id3(fm, argv) {\n  consoler.loading('正在从 ' + fm.home + ' 读取音乐列表');\n\n  sdk.local(fm.home, fm.path.history, function(err, list) {\n    if (err) \n      return consoler.error(err);\n\n    var songs = list.filter(function(song) {\n      var keys = Object.keys(song);\n      if (keys.length === 1 && keys[0] === 'url') return false;\n      return true;\n    });\n\n    if (songs.length === 0) \n      return consoler.error('没有歌曲符合条件');\n\n    consoler.success('找到 ' + songs.length + ' 首有效歌曲，正在添加 id3 信息');\n\n    async.eachLimit(songs, 20, addid3, function(err) {\n      if (err) \n        return consoler.error(err);\n\n      return consoler.success('添加歌曲 id3 信息完成');\n    });\n  });\n\n  /**\n   * [Add ID3 to single song]\n   * @param  {Object}   song     \n   * @param  {Function} callback\n   */\n  function addid3(song, callback) {\n    if (!song.url) \n      return callback(null);\n\n    var id3 = {};\n    id3.artist = song.artist;\n    id3.title = song.title;\n    id3.album = song.albumtitle;\n    id3.date = song.public_time;\n    id3.year = song.public_time;\n    id3.publisher = song.company;\n\n    ffmetadata.write(song.url, id3, function(err) {\n      if (!err) \n        consoler.success('√ ' + id3.title);\n\n      if (err) \n        consoler.error('X ' + id3.title);\n\n      callback(null);\n    });\n  }\n}\n\n/**\n * [http_proxy]\n * @param  {[type]} fm   [description]\n * @param  {[type]} argv [description]\n * @return {[type]}      [description]\n */\nexport function http_proxy(fm, argv) {\n  var profile = {};\n  var defaultProxy = process.env.HTTP_PROXY || process.env.http_proxy || null;\n\n  inquirer.prompt(menu.http_proxy.main(defaultProxy), function(result) {\n    if (!result.useDefaultProxy)\n      return inputNewProxy();\n\n    if (defaultProxy === null || validate(defaultProxy)) {\n      profile.http_proxy = defaultProxy;\n      return updateProxy(profile);\n    }\n\n    console.log(defaultProxy + '格式不符合规范，请输入有效的HTTP_PROXY');\n\n    return inputNewProxy();\n  });\n\n  function validate(value) {\n    var proxyReg = /http:\\/\\/((?:\\d{1,3}\\.){3}\\d{1,3}):(\\d+)/;\n    return proxyReg.test(value);\n  }\n\n  function inputNewProxy() {\n    inquirer.prompt(menu.http_proxy.setting, function(result) {\n      if (!validate(result.http_proxy)) {\n        console.log(result.http_proxy + '格式不符合规范，请输入有效的HTTP PROXY');\n        return inputNewProxy();\n      }\n\n      profile.http_proxy = result.http_proxy;\n\n      return updateProxy(profile);\n    });\n  }\n\n  function updateProxy(profile) {\n    try {\n      fs.updateJSON(fm.path.profile, profile);\n    } catch (err) {\n      if (!utils.noSuchFile(err.message)) return consoler.error(err);\n      fs.writeJSON(fm.path.profile, profile);\n    }\n\n    consoler.success('HTTP PROXY已经成功修改为 ' + profile.http_proxy);\n\n    var f = new Fm;\n    return f.init(exports.ready);\n  }\n}\n\n/**\n * [Show help messages]\n * @return {String} [a help manual]\n */\nexport function help() {\n  consoler.log(`\n    ${ '安装/更新豆瓣电台命令行版：'.yellow }\n    $ [sudo] npm install douban.fm -g\n\n    ${ '豆瓣电台设置：'.green }\n    $ douban.fm config\n\n    ${ '菜单快捷键：'.yellow }\n    [   Return  ]  播放另一个频道，或者重新播放当前频道 (PLAY)\n    [ Backspace ]  停止播放当前歌曲或频道 (DELETE)\n    [     N     ]  本频道列表的下一首歌曲 (NEXT)\n    [     L     ]  添加到红心列表或者删除红心 (LOVE)\n    [     S     ]  分享当前歌曲到新浪微博 (SHARE)\n    [     R     ]  开启或关闭歌词，默认关闭歌词显示 (LRC)\n    [     G     ]  跳转到当前播放歌曲的专辑页面 (GOTO)\n    [     Q     ]  退出豆瓣电台 (QUIT)\n  `)\n}\n\nexport function quit() {\n  return process.exit()\n}\n\nexport function ready() {\n  return consoler.loading('正在加载...')\n}\n"]}